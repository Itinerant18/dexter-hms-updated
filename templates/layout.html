<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}My Flask App{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='asset/TitleLogo.png') }}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">


    {% if request.endpoint in ['device_config', 'powerzone_config'] %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/device_config.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">



    {% elif request.endpoint == 'output_controls' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output_controls.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">



    {% elif request.endpoint == 'general' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/general.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    {% elif request.endpoint == 'advanced' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/advanced.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    {% elif request.endpoint == 'maintenance' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/maintenance.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">





    {% elif request.endpoint == 'logs' %}
    <link rel="stylesheet" href="{{url_for('static',filename='css/logs.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">




    {% elif request.endpoint =='connection'%}
    <link rel="stylesheet" href="{{url_for('static',filename='css/connection.css')}}">



    {% elif request.endpoint =='home'%}
    <link rel="stylesheet" href="{{url_for('static',filename='css/land.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">



    {% elif request.endpoint == 'reports' %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{url_for('static',filename='css/reports.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">




    {% elif request.endpoint in ['connectivity_settings','gnss', 'net_gsm', 'lan'] %}
    <link rel="stylesheet" href="{{url_for('static',filename='css/network.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

 






    {% elif request.endpoint == 'provision' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Provisioning.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">




    {% elif request.endpoint == 'OTA' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/OTA.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    {% elif request.endpoint == 'system_test' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/systemTest.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">




    {% elif request.endpoint == 'device_management' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/deviceManagement.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    {% elif request.endpoint == 'protocol_config' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/protocol_config.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    {% elif request.endpoint == 'device_credential' %}
    <link rel="stylesheet" href="{{url_for('static',filename='css/deviceCredential.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    {% elif request.endpoint == 'come_soon' %}
    <link rel="stylesheet" href="{{url_for('static',filename='css/coming_soon.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    {% elif request.endpoint == 'integration_settings' %}
    <link rel="stylesheet" href="{{url_for('static',filename='css/integrationSettings.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    {% endif %}
    {% block head %}{% endblock %}
</head>

<body>

    <div class="topnav" id="myTopnav">
        <div class="nav-left">
            <button id="menuToggle" class="menu-toggle" type="button" aria-label="Toggle menu" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="nav-center">
            <img class="logo" src="{{url_for('static',filename='asset/Dexter2.png')}}" alt="Logo">
        </div>
        <div class="nav-right">
            <div class="dropdown2">
                <button class="dropbtn2">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <div class="dropdown-content2">
                    <a href="#" onclick="handleLogout()">Logout</a>
                    <a href="#" onclick="handleReboot()">Reboot</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Overlay for mobile menu -->
    <div id="menuOverlay" class="menu-overlay" onclick="closeMobileMenu()"></div>
    
    <!-- side-menu starts -->
    <div class="side-menu" id="sideMenu">
        <div class="menu-item {% if request.endpoint == 'home' %}active{% endif %}">
            <a href="/home">Home</a>
        </div>

        <div
            class="menu-item {% if request.endpoint in ['device_config', 'powerzone_config', 'output_controls'] %}active{% endif %}">
            <a href="#" class="submenu-toggle">Device Configuration</a>
            <div class="submenu">
                <a href="/device_config" {% if request.endpoint=='device_config' %}class="active" {% endif %}>Normal
                    Zone Config</a>
                <a href="/powerzone_config" {% if request.endpoint=='powerzone_config' %}class="active" {% endif
                    %}>Power Zone Config</a>
                <a href="/output_controls" {% if request.endpoint=='output_controls' %}class="active" {% endif %}>Output
                    Management</a>
            </div>
        </div>

        <div class="menu-item {% if request.endpoint in ['logs', 'reports'] %}active{% endif %}">
            <a href="#" class="submenu-toggle">Events & Log Management</a>
            <div class="submenu">
                <a href="/logs" {% if request.endpoint=='logs' %}class="active" {% endif %}>Logs Settings</a>
                <a href="/reports" {% if request.endpoint=='reports' %}class="active" {% endif %}>Event Reports</a>
            </div>
        </div>

        <div class="menu-item {% if request.endpoint in ['connectivity_settings', 'gnss', 'device_credential', 'net_gsm','lan'] %}active{% endif %}">
            <a href="#" class="submenu-toggle">Network & Comms Settings</a>
            <div class="submenu">
                <a href="/connectivity_settings" {% if request.endpoint=='connectivity_settings' %}class="active" {%
                    endif %}>Connectivity Settings</a>
                <a href="/gnss" {% if request.endpoint=='gnss' %}class="active" {% endif %}>GNSS Settings</a>
                <a href="/device_credential" {% if request.endpoint=='device_credential' %}class="active" {% endif %}>Device Credential</a>
              
                <a href="/net_gsm" {% if request.endpoint=='net_gsm' %}class="active" {% endif %}>GSM Settings</a>
                <a href="/lan" {% if request.endpoint=='lan' %}class="active" {% endif %}>Lan Setup</a>
            </div>
        </div>

        <div class="menu-item {% if request.endpoint in ['integration_settings', 'device_management'] %}active{% endif %}">
            <a href="#" class="submenu-toggle">Device Integration</a>
            <div class="submenu">
                <a href="/integration_settings" {% if request.endpoint=='integration_settings' %}class="active" {% endif %}>Integration Settings</a>
                <a href="/device_management" {% if request.endpoint=='device_management' %}class="active" {% endif %}>Device Management</a>
            </div>
        </div>

        <div class="menu-item {% if request.endpoint == 'come_soon' and 'power' in request.args %}active{% endif %}">
            <a href="#" class="submenu-toggle">Power Management</a>
            <div class="submenu">
                <a href="/come_soon?power=battery" {% if request.endpoint=='come_soon' and
                    request.args.get('power')=='battery' %}class="active" {% endif %}>Low Battery</a>
                <a href="/come_soon?power=backup" {% if request.endpoint=='come_soon' and
                    request.args.get('power')=='backup' %}class="active" {% endif %}>Power Backup Config</a>
            </div>
        </div>

        <div class="menu-item {% if request.endpoint in ['general', 'maintenance', 'advanced'] %}active{% endif %}">
            <a href="#" class="submenu-toggle">System Settings</a>
            <div class="submenu">
                <a href="/general" {% if request.endpoint=='general' %}class="active" {% endif %}>General Settings</a>
                <a href="/maintenance" {% if request.endpoint=='maintenance' %}class="active" {% endif
                    %}>Maintenance</a>
                <a href="/advanced" {% if request.endpoint=='advanced' %}class="active" {% endif %}>Advanced
                    Settings</a>
            </div>
        </div>

        <div class="menu-item {% if request.endpoint == 'system_test' %}active{% endif %}">
            <a href="/system_test">System Test</a>
        </div>

        <div class="menu-item {% if request.endpoint ==  'protocol_config' %}active{% endif %}">
            <a href="/protocol_config">Protocol Configuration</a>
        </div>


        <div class="menu-item {% if request.endpoint in [ 'provision'] %}active{% endif %}">
            <a href="#" class="submenu-toggle">Device Registration</a>
            <div class="submenu">
                <!-- <a href="/SOL" {% if request.endpoint == 'SOL' %}class="active"{% endif %}>SOL ID</a> -->
                <a href="/provision" {% if request.endpoint=='provision' %}class="active" {% endif %}>Device
                    Provisioning</a>
            </div>
        </div>

        <div class="menu-item {% if request.endpoint == 'OTA' %}active{% endif %}">
            <a href="/OTA">OTA Update</a>
        </div>
    </div>

    {% block body %}


    {% endblock %}


    <script>
        function restart() {
            fetch('/restart', { method: 'POST' })
                .then(response => response.text())
                .then(data => alert(data))
                .catch(error => console.error('Error:', error));
        }

        function terminate() {
            fetch('/terminate', { method: 'POST' })
                .then(response => response.text())
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('loading-screen').style.display = 'none';
                });
        }
        
        function handleLogout() {
            // Show a loading indicator or spinner
            const loadingOverlay = document.createElement('div');
            loadingOverlay.classList.add('loading-overlay');
            loadingOverlay.innerHTML = '<div class="loading-spinner"></div><p>Logging out...</p>';
            document.body.appendChild(loadingOverlay);
            
            // Redirect to the logout route
            window.location.href = "/logout";
        }
        
        function handleReboot() {
            if (confirm("Are you sure you want to reboot the system?")) {
                // Show a loading indicator
                const loadingOverlay = document.createElement('div');
                loadingOverlay.classList.add('loading-overlay');
                loadingOverlay.innerHTML = '<div class="loading-spinner"></div><p>System is rebooting...</p>';
                document.body.appendChild(loadingOverlay);
                
                // Call your existing restart function
                restart();
            }
        }

        // Toggle dropdown on button click
        document.querySelector('.dropbtn2').addEventListener('click', function (event) {
            event.stopPropagation();
            let dropdownContent = document.querySelector('.dropdown-content2');
            if (dropdownContent.style.display === 'block') {
                dropdownContent.style.display = 'none';
            } else {
                dropdownContent.style.display = 'block';
            }
        });

        // Close the dropdown if the user clicks outside of it
        window.onclick = function (event) {
            if (!event.target.matches('.dropbtn2')) {
                let dropdownContent = document.querySelector('.dropdown-content2');
                if (dropdownContent.style.display === 'block') {
                    dropdownContent.style.display = 'none';
                }
            }
        };

        // Function to show the red dot
        function showNotification() {
            document.getElementById('notificationBadge').style.display = 'block';
        }

        // Function to hide the red dot when the button is clicked
        function hideNotification() {
            document.getElementById('notificationBadge').style.display = 'none';
        }

        // Event listener for button click
        document.getElementById('notificationButton').addEventListener('click', hideNotification);

        // Example function to simulate new logs arrival
        function fetchLogs() {
            // Simulate fetching logs
            console.log("Fetching new logs...");
            // Show notification red dot when new logs arrive
            showNotification();
        }

        // Simulate fetching logs every 10 seconds
        setInterval(fetchLogs, 10000);

        // Make the entire menu item clickable, not just the text
        document.querySelectorAll('.side-menu .menu-item').forEach(function (menuItem) {
            menuItem.addEventListener('click', function (e) {
                // Get the anchor element within this menu item
                const link = this.querySelector('a');

                // If the click was not directly on a submenu link
                if (!e.target.closest('.submenu')) {
                    e.preventDefault();

                    // If the link has the submenu-toggle class, toggle the submenu
                    if (link.classList.contains('submenu-toggle')) {
                        // The default tabindex and :focus-within CSS will handle the actual toggling
                        link.focus();
                    } else {
                        // For direct links (no submenu), navigate to the href
                        window.location.href = link.getAttribute('href');
                    }
                }
            });
        });

        // Debug helper - add to window load
        window.addEventListener('load', function() {
            console.log("Window loaded - checking menu toggle");
            const menuToggle = document.getElementById('menuToggle');
            if (menuToggle) {
                console.log("Menu toggle found:", menuToggle);
                console.log("Menu toggle display:", getComputedStyle(menuToggle).display);
                console.log("Menu toggle visibility:", getComputedStyle(menuToggle).visibility);
                
                // Force display the menu toggle button on mobile
                if (window.innerWidth <= 768) {
                    console.log("Mobile view detected - forcing menu toggle visibility");
                    menuToggle.style.display = 'flex';
                    menuToggle.style.visibility = 'visible';
                    menuToggle.style.opacity = '1';
                }
            } else {
                console.error("Menu toggle not found!");
            }
        });
        
        // Simple mobile menu toggle function
        function toggleMobileMenu() {
            console.log("Toggle menu function called");
            var sideMenu = document.getElementById('sideMenu');
            var menuOverlay = document.getElementById('menuOverlay');
            var body = document.body;
            
            if (sideMenu.classList.contains('open')) {
                sideMenu.classList.remove('open');
                menuOverlay.classList.remove('active');
                body.classList.remove('menu-open');
                console.log("Menu closed");
            } else {
                sideMenu.classList.add('open');
                menuOverlay.classList.add('active');
                body.classList.add('menu-open');
                console.log("Menu opened");
            }
            
            return false;
        }
        
        function closeMobileMenu() {
            var sideMenu = document.getElementById('sideMenu');
            var menuOverlay = document.getElementById('menuOverlay');
            var body = document.body;
            
            sideMenu.classList.remove('open');
            menuOverlay.classList.remove('active');
            body.classList.remove('menu-open');
        }
        
        // Handle submenu toggle on mobile
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure submenu behavior is consistent on mobile
            const submenuToggles = document.querySelectorAll('.submenu-toggle');
            
            submenuToggles.forEach(function(toggle) {
                toggle.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        // Don't close the mobile menu when opening a submenu
                        e.stopPropagation();
                        
                        // Only handle submenu display/toggle
                        const menuItem = this.closest('.menu-item');
                        const submenu = menuItem.querySelector('.submenu');
                        
                        if (submenu) {
                            if (window.getComputedStyle(submenu).display === 'flex') {
                                submenu.style.display = 'none';
                            } else {
                                submenu.style.display = 'flex';
                            }
                        }
                    }
                });
            });
            
            // Close mobile menu when clicking a direct link
            const directLinks = document.querySelectorAll('.side-menu .menu-item a:not(.submenu-toggle), .side-menu .submenu a');
            
            directLinks.forEach(function(link) {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 768 && !this.classList.contains('submenu-toggle')) {
                        closeMobileMenu();
                    }
                });
            });
        });

    </script>

</body>

</html>